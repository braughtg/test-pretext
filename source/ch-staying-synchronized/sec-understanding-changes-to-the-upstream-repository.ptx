<?xml version="1.0" encoding="UTF-8"?>

<section xml:id="topic-understanding-changes-to-the-upstream-repository" xmlns:xi="http://www.w3.org/2001/XInclude" >
  <title>Understanding Changes to the Upstream Repository</title>

  <introduction>
    <p>
      If the upstream maintainers decide that the changes in your PR (pull request) are good for the project, they will merge them into the upstream <c>main</c> branch.
      That way they become a part of the main project, and everyone can benefit from your work.
      In class your instructor played the role of an upstream maintainer and demonstrated how the changes contained in pull requests are merged.
    </p>
  </introduction>

  <exercises>
  <title />
  <p>
    <xref ref="fig-changes-merged-into-upstream" /> illustrates the state after several commits have been merged into upstream <c>main</c>.
  </p>

  <p>
    <figure xml:id="fig-changes-merged-into-upstream" >
      <caption> Changes Merged into Upstream. </caption>
      <image source="images/ch-staying-synchronized/changes-merged-into-upstream.png" width="75%">
        <description>
          Cloud image of the changes merged into upstream.
        </description>
      </image>
    </figure>
  </p>

  <exercise xml:id="ex-merged-commits" label="ex-merged-commits">
    <introduction>
      <p>
        Answer the following questions using <xref ref="fig-changes-merged-into-upstream" />
      </p>
    </introduction>


    <task xml:id="ex-merged-commits-a" label="ex-merged-commits-a">
      <statement>
        <p>
          Which commits (give the colors) were merged into the upstream <c>main</c> since the contributor created the feature branch that is shown?
        </p>
      </statement>


      <choices>
        <choice>
          <statement>
            <p>
              Red
            </p>
          </statement>
        </choice>

        <choice>
          <statement>
            <p>
              Yellow
            </p>
          </statement>
        </choice>

        <choice>
          <statement>
            <p>
              Green
            </p>
          </statement>
        </choice>

        <choice>
          <statement>
            <p>
              Blue
            </p>
          </statement>
        </choice>

        <choice correct="yes">
          <statement>
            <p>
              Pink
            </p>
          </statement>
        </choice>

        <choice correct="yes">
          <statement>
            <p>
              Lime Green
            </p>
          </statement>
        </choice>
      </choices>

      <hint>
        <p>
          Look at which commits are new in upstream that are not part of the local repository's <c>main</c> or feature branch.
        </p>
      </hint>
    </task>


    <task xml:id="ex-merged-commits-b" label="ex-merged-commits-b">
      <statement>
        <p>
          Which of the commits did the managers merge from the contributor's pull request?
        </p>
      </statement>


      <choices>
        <choice>
          <statement>
            <p>
              Red
            </p>
          </statement>

          <feedback>
            <p>
              Red was in <c>main</c> prior to the contributor creating the feature branch.
            </p>
          </feedback>
        </choice>

        <choice>
          <statement>
            <p>
              Yellow
            </p>
          </statement>

          <feedback>
            <p>
              Yellow was in <c>main</c> prior to the contributor creating the feature branch.
            </p>
          </feedback>
        </choice>

        <choice>
          <statement>
            <p>
              Green
            </p>
          </statement>

          <feedback>
            <p>
              Green was in <c>main</c> prior to the contributor creating the feature branch.
            </p>
          </feedback>
        </choice>

        <choice correct="yes">
          <statement>
            <p>
              Blue
            </p>
          </statement>

          <feedback>
            <p>
              Blue was part of the contributor's feature branch.
            </p>
          </feedback>
        </choice>

        <choice>
          <statement>
            <p>
              Pink
            </p>
          </statement>

          <feedback>
            <p>
              Pink was part of another contributor's pull request.
            </p>
          </feedback>
        </choice>

        <choice>
          <statement>
            <p>
              Lime Green
            </p>
          </statement>

          <feedback>
            <p>
              Lime green was part of another contributor's pull request.
            </p>
          </feedback>
        </choice>
      </choices>

      <hint>
        <p>
          Look at which commits are in the local repository's feature branch.
        </p>
      </hint>
    </task>


    <task xml:id="ex-merged-commits-c" label="ex-merged-commits-c">
      <statement>
        <p>
          How could have the pink commit gotten into the upstream <c>main</c>?
        </p>
      </statement>


      <choices randomize="yes">
        <choice>
          <statement>
            <p>
              The contributor made the pink commit as part of their branch.
            </p>
          </statement>

          <feedback>
            <p>
              The contributor's branch did not contain the pink commit.
            </p>
          </feedback>
        </choice>

        <choice>
          <statement>
            <p>
              The manager accepted the contributor's pull request.
            </p>
          </statement>

          <feedback>
            <p>
              The contributor's pull request contained the blue commit, not the pink commit.
            </p>
          </feedback>
        </choice>

        <choice correct="yes">
          <statement>
            <p>
              The manager accepted a pull request of another contributor which contained the pink commit.
            </p>
          </statement>

          <feedback>
            <p>
              The pink commit was part of a branch that another contributor submitted as part of a pull request.
            </p>
          </feedback>
        </choice>

        <choice>
          <statement>
            <p>
              The pink commit is not part of the upstream <c>main</c>.
            </p>
          </statement>

          <feedback>
            <p>
              Pink is part of the upstream <c>main</c>.
              It was merged after the pull request that contained the blue commit.
            </p>
          </feedback>
        </choice>
      </choices>

      <hint>
        <p>
          Look at which commits are in the local repository's feature branch.
          This shows the changes made by this contributor.
          Other changes were made by other contributors and accepted by the manager as part of a pull request.
        </p>
      </hint>
    </task>
  </exercise>

  <exercise xml:id="ex-origin-main-behind-main" label="ex-origin-main-behind-main" >
    <introduction>
      <p>
        GitHub will inform you when the active branch in your origin repo is out of synch with the upstream.
      </p>

      <p>
        Use your browser to visit your origin repo on GitHub and ensure that the <c>main</c> branch is selected.
        Find the part of the page that indicates that your <c>main</c> branch is <em>behind</em> (i.e.
        not the same as, or out of synch with) the upstream <c>main</c>.
      </p>

      <p>
        If you do not see a message that your main branch is behind the upstream <c>main</c> branch go to <xref ref="topic-appendix-a-staying-synchronized" /> of this chapter and follow the instructions there.
        Once you complete <xref ref="topic-appendix-a-staying-synchronized" />, return to <xref ref="ex-origin-main-behind-main" />.
      </p>
    </introduction>


    <task xml:id="ex-origin-main-behind-main-a" label="ex-origin-main-behind-main-a">
      <statement>
        <p>
          Which of the following messages do you see that indicates that your origin’s main branch is behind the upstream <c>main</c>?
        </p>
      </statement>


      <choices randomize="yes">
        <choice correct="yes">
          <statement>
            <p>
              This branch is xxx commits behind <c>main</c>.
              Where xxx is a number.
            </p>
          </statement>

          <feedback>
            <p>
              Correct!
            </p>
          </feedback>
        </choice>

        <choice>
          <statement>
            <p>
              This branch is xxx commits ahead of <c>main</c>.
              Where xxx is a number.
            </p>
          </statement>

          <feedback>
            <p>
              Your origin main branch would be ahead of upstream <c>main</c> if it contains changes that upstream <c>main</c> does not which is not the case.
            </p>
          </feedback>
        </choice>

        <choice>
          <statement>
            <p>
              This branch is up to date with <c>main</c>.
            </p>
          </statement>

          <feedback>
            <p>
              Your origin's main branch should not be up to date with the upstream <c>main</c>.
            </p>
          </feedback>
        </choice>
      </choices>

      <hint>
        <p>
          Think about what happens if the manager accepts pull requests.
          Where do those changes go, upstream or origin?
        </p>
      </hint>
    </task>


    <task xml:id="ex-origin-main-behind-main-b" label="ex-origin-main-behind-main-b">
      <statement>
        <p>
          Which of the following describes what has happened that caused your origin’s main branch to get behind the upstream <c>main</c>?
        </p>
      </statement>


      <choices  randomize="yes">
        <choice>
          <statement>
            <p>
              Another contributor pushed to upstream <c>main</c>.
            </p>
          </statement>

          <feedback>
            <p>
              No one can push to upstream <c>main</c>.
            </p>
          </feedback>
        </choice>

        <choice>
          <statement>
            <p>
              You have changes in your local branch that have not been pushed up to the upstream <c>main</c>.
            </p>
          </statement>

          <feedback>
            <p>
              You cannot push to upsteam <c>main</c>.
            </p>
          </feedback>
        </choice>

        <choice>
          <statement>
            <p>
              You haven't pushed your local changes to your remote branch.
            </p>
          </statement>

          <feedback>
            <p>
              Your origin's feature branch does not impact whether or not the origin's main branch is up to date with the upstream <c>main</c>.
            </p>
          </feedback>
        </choice>

        <choice correct="yes">
          <statement>
            <p>
              The manager accepted a pull request of another contributor which is now part of the upstream <c>main</c>.
              Your origin's main branch has not been updated to include these changes.
            </p>
          </statement>

          <feedback>
            <p>
              When the manager accepted the pull request those changes were merged into the upstream <c>main</c>.
              You need to pull those changes into your local main branch and push those changes to the origin.
            </p>
          </feedback>
        </choice>
      </choices>

      <hint>
        <p>
          Think about what changes may have been made while you were working on your branch.
          What might have happened during that time.
        </p>
      </hint>
    </task>
  </exercise>
  </exercises>
</section>
